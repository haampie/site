var u=function(){function i(b,a){if(c[a][b].d)return 0;c[a][b].d=true;var f=1;if(b+1<d.e&&!c[a][b+1].d&&c[a][b+1].a==c[a][b].a&&!c[a][b+1].b)f+=i(b+1,a);if(b-1>=0&&!c[a][b-1].d&&c[a][b-1].a==c[a][b].a&&!c[a][b-1].b)f+=i(b-1,a);if(a+1<d.c&&!c[a+1][b].d&&c[a+1][b].a==c[a][b].a&&!c[a+1][b].b)f+=i(b,a+1);if(a-1>=0&&!c[a-1][b].d&&c[a-1][b].a==c[a][b].a&&!c[a-1][b].b)f+=i(b,a-1);return f}function h(){if(!n){e.clearRect(0,0,e.canvas.width,e.canvas.height);for(var b=0;b<d.c;b++)for(var a=0;a<d.e;a++){if(c[b][a].d&&
g>1){e.fillStyle=d.g[c[b][a].a];e.globalAlpha=0.4;e.beginPath();e.arc(d.zoom*(a+0.5)+d.padding,d.zoom*(b+0.5)+d.padding,d.zoom/2+2,0,2*Math.PI,true);e.fill();e.globalAlpha=1;e.closePath()}e.fillStyle=c[b][a].b?"white":d.g[c[b][a].a];e.beginPath();e.arc(d.zoom*(a+0.5)+d.padding,d.zoom*(b+0.5)+d.padding,d.zoom/2-2,0,2*Math.PI,true);e.fill();e.closePath();e.fillStyle="rgba(255, 255, 255, .2)";e.beginPath();e.arc(d.zoom*(a+0.4)+d.padding,d.zoom*(b+0.4)+d.padding,d.zoom/3-2,0,2*Math.PI,true);e.fill();
e.closePath()}}}function q(){for(var b=d.e-1;b>=0;b--){if(c[d.c-1][b].b)break;for(var a=d.c-1;a>=0;a--){if(c[a][b].b)break;if(b+1<d.e&&!c[a][b+1].b&&c[a][b+1].a==c[a][b].a)return true;if(b-1>=0&&!c[a][b-1].b&&c[a][b-1].a==c[a][b].a)return true;if(a+1<d.c&&!c[a+1][b].b&&c[a+1][b].a==c[a][b].a)return true;if(a-1>=0&&!c[a-1][b].b&&c[a-1][b].a==c[a][b].a)return true}}return false}function o(){for(var b=false,a=d.e-1;a>0;a--)for(var f=0;f<d.c;f++)if(!c[d.c-1][a-1].b&&c[d.c-1][a].b){if(!c[f][a-1].b){c[f][a].a=
c[f][a-1].a;c[f][a].b=false;b=c[f][a-1].b=true}}else break;if(b){setTimeout(o,100);h()}else{l=false;if(!q()){n=true;e.font="20px Verdana";e.textAlign="center";e.fillStyle="black";e.fillText("C'est Fini!",e.canvas.width/2,50);e.fillText(m,e.canvas.width/2,90)}}}function p(){for(var b=false,a=0;a<d.e;a++)for(var f=d.c-1;f>0;f--)if(!c[f-1][a].b&&c[f][a].b){c[f][a].a=c[f-1][a].a;c[f][a].b=false;b=c[f-1][a].b=true}if(b){h();setTimeout(p,100)}else o()}function k(b){for(var a=0;a<d.c;a++)for(var f=0;f<d.e;f++)if(c[a][f].d){c[a][f].d=
false;if(b&&g>1)c[a][f].b=true}}function r(b){if(l)return false;var a=b.pageY-e.canvas.offsetTop-d.padding;b=Math.floor((b.pageX-e.canvas.offsetLeft-d.padding)/d.zoom);a=Math.floor(a/d.zoom);if(c[a][b].b){k(false);h()}else if(c[a][b].d){k(true);if(g>1){l=true;h();p();m+=g*(g-1);d.h.innerHTML=m;d.f.innerHTML=0}}else{g>0&&k(false);g=i(b,a);d.f.innerHTML=g*(g-1);h()}}function s(b){e=b.canvas.getContext("2d");d.f=b.f;d.h=b.h;d.e=(e.canvas.width-2*d.padding)/d.zoom;d.c=(e.canvas.height-2*d.padding)/d.zoom;
for(b=0;b<d.c;b++){c[b]=[];for(var a=0;a<d.e;a++)for(var f=Math.random(),j=0;j<d.g.length;j++)if(f<(j+1)/d.g.length){e.fillStyle=d.g[j];c[b][a]={b:false,a:j,d:false};break}}h();e.canvas.onclick=r;document.onclick=function(t){if(!t.target.isSameNode(e.canvas)&&g>1){k(false);d.f.innerHTML=0;h()}}}var e,d={e:980,c:600,zoom:30,j:false,g:["green","blue","red","purple","orange"],padding:10,f:null,h:null},c=[],m=0,g=0,n=false,l=false;return{i:s}}();
window.onload=function(){u.i({canvas:document.getElementById("canvas"),f:document.getElementById("zet"),h:document.getElementById("punten")})};